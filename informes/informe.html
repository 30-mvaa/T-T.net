<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Reporte de Recaudación Mensual</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../informes/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
     <!-- Basic -->
     <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Mobile metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Site metas -->
    <title>T&T.NET</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Recaudación</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<header >
                        <!-- header inner -->
                        <div class="header" style="height: 50px; width: 100%;margin-top:0px; ">
                            <div class="container-fluid"  >
                                <div class="row" >
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col logo_section">
                                        <div class="full">
                                            <div class="center-desk">
                                                <div class="logo">
                                                    <a href="../vista/admi.html"><img src="../images/logo.png" alt="#" /></a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9">
                                        <div class="header_information"  style=" width:1000px ">
                                            <nav class="navigation navbar navbar-expand-md navbar-dark ">
                                                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
                                                    <span class="navbar-toggler-icon"></span>
                                                </button>
                                                <div class="collapse navbar-collapse" id="navbarsExample04">
                                                    <!-- Botónes de navegación -->
                                                   
                                                    <!-- Botón de menú Inicio -->
                                                    <div class="sign_btn">
                                                        <a href="../vista/admi.html">
                                                            <i class="bi bi-list"></i> <!-- Icono de menú de Bootstrap Icons -->
                                                            Inicio
                                                        </a>
                                                    </div>
                                                    <!-- Bootstrap Bundle JS -->
                                                    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
                                                    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
                                                </div>
                                            </nav>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
 </header>

 <body >
    <center>
        <div class="container mt-5">
            <h1 class="display-4 text-center text-primary mb-4">Reporte de Recaudación Mensual</h1>
            <!-- Aquí iría el resto del contenido -->
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    </center>
    <section class="content"  style="margin-top: 40px; ">
       
       

    <!-- Select para elegir el tipo de gráfico -->
    <label for="chartType">Selecciona el tipo de gráfico:</label>
    <select id="chartType" onchange="updateChartType()">
        <option value="line">Línea</option>
        <option value="bar">Barras</option>
        <option value="pie">Pastel</option>
    </select>
    <br>
    <br>  
    <canvas style="  width: 300px; height: 200px;" id="myChart"></canvas>

        

    <script>
        let chartInstance;

        // Función para convertir números de meses a nombres
        function getMonthName(monthNumber) {
            const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", 
                                "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
            return monthNames[monthNumber - 1];
        }

        // Función para crear y actualizar el gráfico
        function createChart(data, chartType) {
            const ctx = document.getElementById('myChart').getContext('2d');
            
            // Si ya existe una instancia de gráfico, destrúyela antes de crear una nueva
            if (chartInstance) {
                chartInstance.destroy();
            }

            chartInstance = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: data.meses.map(mes => getMonthName(mes)),
                    datasets: [{
                        label: 'Recaudación Mensual',
                        data: data.ingresos,
                        backgroundColor: chartType === 'pie' 
                            ? [
                                'rgba(54, 162, 235, 0.2)',
                                'rgba(255, 99, 132, 0.2)', 
                                'rgba(75, 192, 192, 0.2)'] 
                                : 'rgba(54, 162, 235, 0.2)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: chartType !== 'pie' ? {
                        x: {
                            title: {
                                display: true,
                                text: 'Meses',
                                color: ' #2f2d84', // Cambia el color del título del eje X
                                font: {
                                    size: 25 // Cambia el tamaño del texto del título del eje X
                                }
                            },
                            ticks: {
                            color: 'black', // Cambia el color de los ticks del eje X
                            font: {
                                size: 20 // Cambia el tamaño del texto de los ticks del eje X
                            }
                         }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Cantidad',
                                color: ' #2f2d84', // Cambia el color del título del eje X
                                font: {
                                    size: 25 // Cambia el tamaño del texto del título del eje X
                                }
                            },
                            ticks: {
                            color: 'black', // Cambia el color de los ticks del eje X
                            font: {
                                size: 20 // Cambia el tamaño del texto de los ticks del eje X
                            }
                          }
                        
                        }
                    } : {}, // No usar escalas en gráficos de tipo pastel
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(tooltipItem) {
                                    return `Cantidad: $${tooltipItem.raw}`;
                                }
                            },
                            

                        },
                        datalabels: chartType !== 'pie' ? {
                            display: true,
                            align: 'end',
                            anchor: 'end',
                            formatter: function(value) {
                                return `$${value}`;
                            },
                            font: {
                            size: 16, // Tamaño de la fuente para las etiquetas de datos
                            weight: 'bold' // Peso del texto para las etiquetas de datos
                            },
                           color: 'black' // Color del texto de las etiquetas de datos
                    
                        } : {} // No mostrar valores sobre las porciones de pastel
                    }
                },
                plugins: [ChartDataLabels]
            });
        }

        // Función para actualizar el tipo de gráfico según la selección
        function updateChartType() {
            const selectedChartType = document.getElementById('chartType').value;
            fetch('../informes/datos.php')
                .then(response => response.json())
                .then(data => {
                    createChart(data, selectedChartType);
                })
                .catch(error => console.error('Error:', error));
        }

        // Cargar los datos y crear el gráfico por primera vez (tipo línea por defecto)
        fetch('../informes/datos.php')
            .then(response => response.json())
            .then(data => {
                document.getElementById('ingreso').textContent = `$${data.total_ingreso}`;
                document.getElementById('egreso').textContent = `$${data.egresos}`;
                document.getElementById('saldo').textContent = `$${data.saldo}`;
                createChart(data, 'line'); // Gráfico por defecto: línea
            })
            .catch(error => console.error('Error:', error));
    </script>
    </section>
   <center>
        <div class="cantidad">
            <h1>Ingreso Total: <span id="ingreso"></span></h1>
        </div>
        <div class="cantidad">
            <h1>Egreso Total: <span id="egreso"></span></h1>
        </div>
        <div class="cantidad">
            <h1>Saldo: <span id="saldo"></span></h1>
        </div>
        <br>
         <br>
   </center>

    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
</body>



    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>



    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <!-- Font Awesome for social icons -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    
</html>


